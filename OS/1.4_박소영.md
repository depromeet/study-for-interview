# 1. OS

1. 프로세스와 스레드 차이
2. 가상 메모리 및 관리, 쓰레싱 방지 법
3. CPU 스케줄링
4. **데드락 정의 및 처리 방법**

**작성일** : ``2018.11.21``

**작성자** : `박소영`



***

## 데드락 정의 및 처리 방법

### 1) 정의

- 한 프로세스가 자원을 요청하였으나, 그 자원을 필요로 하는 시간에 사용할 수 없다면 대기 상태로 진입한다.

  → 그 필요 자원이 또 다른 자원의 할당을 위해 대기 중인 다른 프로세스에 의해 점유되어 있고, 이런 형태의 대기가 **꼬리에 꼬리를 물며 환형을 이루면** 참여한 프로세스들은 **영원히 대기 상태에서 벗어날 수 없다**

  ![이미지](http://pages.cs.wisc.edu/~bart/537/lecturenotes/figures/s12.lock.gif)

  

- **교착 상태 **(deadlock)란 두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 결과적으로 아무것도 완료되지 못하는 상태를 가리킨다. 

  

### 2) 조건

- **상호배제** (Mutual exclusion) : 할당 후 반환까지 **한 프로세스만** 사용하는 자원이어야 한다.
- **점유대기** (Hold and wait) : 프로세스가 **할당된 자원을 가진 상태**에서 다른 자원을 기다린다.
- **비선점** (No preemption) : 프로세스가 할당받은 자원은 사용을 끝낼 때까지 **강제로 빼앗을 수 없다.**
- **환형대기** (Circular wait) : 각 프로세스는 **순환적으로** 다음 프로세스가 요구하는 자원을 가진다.



### 3) 처리 방법

> - 교착 상태가 되지 않도록 사전에 조치 : **예방** (prevent), **회피** (avoid)
> - 교착 상태를 방치한 후 탐지해 복구 : **탐지** (detection), **복구** (recovery)

- **교착 상태 예방** (prevent) : 교착 상태 발생의 4가지 조건 중 **하나만 일어나지 않아도** 예방 가능

  - **상호배제** 조건 제거 : 일반적으로 상호 배제를 부인해 교착 상태를 방지하는 것은 **불가능**

  - **점유대기** 조건 제거

    1. 모든 자원을 실행 전에 확보하도록 한다.
    2. 자원을 가지고 있지 않은 경우에만 요청하도록 한다. **기아 상태 발생의 가능성이 증가함**

  - **비선점** 조건 제거 : **상태의 보존과 복구**를 통해 선점이 가능하도록 한다.

    - 자원을 보유하고 있는 임의의 프로세스가 지금 할당받을 수 없는 자원을 요청한다면

      → **대기 상태로 들어가면서 현재 할당 받은 것을 강제로 반환하도록 한다**

  - **환형대기** 조건 제거 : 각 자원에 번호를 부여해, **순서대로만 자원을 요청**하도록 강제함!

    - 한 프로세스가 가진 자원 중에서 번호가 제일 큰 것이 **i**라면

      → 그 프로세스는 그것보다 번호가 큰 자원인 **i+1**부터 **m** 까지만 요청할 수 있ㅏ.

    

- **교착 상태 회피** (avoid) : 프로세스와 자원에 대한 **추가 정보**를 제공받아 자원 할당 상태를 검사한다.

  - **은행원 알고리즘** (Banker's algorithm) : 각 자원에 대한 **최대 요구량**을 선언토록 요구한다.

    +) 현재 요청을 수락한다면, 그 다음에 발생하는 상태의 안정성을 **미리 검토**한다.

  - 자원 할당시 시스템이 항상 **안정상태**에 있도록 유지해야 한다.

    - **안정상태** : 각 프로세스에 최고치까지 자원 할당이 가능하며, 교착상태를 방지할 수 있는 상태

      

- **교착 상태 탐지** (detection) : 교착 상태의 상태를 검사하는 알고리즘을 주기적으로 수행한다.

  

- **교착 상태 복구** (recovery) : 교착 상태가 탐지된 후에는 이를 복구해줘야 한다.

  - **종료** (Abort) : 교착 상태의 프로세스를 모두 중지하거나, 교착 상태가 제거될 때까지 하나씩 중지시킨다.
  - **선점** (Resource Preemption) : 교착 상태에 있는 프로세스가 갖고 있는 자원을 계속적으로 선점해 다른 프로세스에게 넘긴다.
    - **후퇴** (rollback) 필요 : 안정상태로 rollback 시키고 그 상태로 다시 시작해야 한다.
    - **기아 상태**가 발생하지 않도록 프로세스를 잘 선정해야 한다.



+ **교착 상태 무시** : 예방이나 회피 기법을 프로그래밍해서 넣으면 성능에 좋지 않을 수 있으므로, 교착 상태의 발생 가능성이 비교적 낮은 경우 조치를 취하지 않고 무시한다.	